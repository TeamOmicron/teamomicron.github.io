
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation website for Team Omicron, an open-source RoboCup Jr Open Soccer team from Brisbane Boys' College.">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>Finite State Machine - Team Omicron</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#finite-state-machine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Team Omicron" class="md-header-nav__button md-logo" aria-label="Team Omicron">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Team Omicron
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Finite State Machine
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Team Omicron" class="md-nav__button md-logo" aria-label="Team Omicron">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Team Omicron
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    <label class="md-nav__link" for="nav-3">
      Hardware
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Hardware" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Hardware
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../structural_design/" class="md-nav__link">
      Structural design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../electrical_design/" class="md-nav__link">
      Electrical design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sbc/" class="md-nav__link">
      SBC & Camera
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    <label class="md-nav__link" for="nav-4">
      Software
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Software" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../open_source_release/" class="md-nav__link">
      Our open-source release!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../omicam/" class="md-nav__link">
      Omicam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../omicontrol/" class="md-nav__link">
      Omicontrol
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Finite State Machine
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Finite State Machine
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    Benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drawbacks" class="md-nav__link">
    Drawbacks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#states" class="md-nav__link">
    States
  </a>
  
    <nav class="md-nav" aria-label="States">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attacker-states" class="md-nav__link">
    Attacker states
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defender-states" class="md-nav__link">
    Defender states
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-states-shared" class="md-nav__link">
    General states (shared)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timers" class="md-nav__link">
    Timers
  </a>
  
    <nav class="md-nav" aria-label="Timers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-of-timers" class="md-nav__link">
    List of timers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../strategy/" class="md-nav__link">
      Game strategies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../protobuf/" class="md-nav__link">
      Protocol Buffers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../communication/" class="md-nav__link">
      Communication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lowlevel/" class="md-nav__link">
      Low-level code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../open_source/" class="md-nav__link">
      Third party library notices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../future_work/" class="md-nav__link">
      Future ideas
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    Benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drawbacks" class="md-nav__link">
    Drawbacks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#states" class="md-nav__link">
    States
  </a>
  
    <nav class="md-nav" aria-label="States">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attacker-states" class="md-nav__link">
    Attacker states
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defender-states" class="md-nav__link">
    Defender states
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-states-shared" class="md-nav__link">
    General states (shared)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timers" class="md-nav__link">
    Timers
  </a>
  
    <nav class="md-nav" aria-label="Timers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-of-timers" class="md-nav__link">
    List of timers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="finite-state-machine">Finite State Machine</h1>
<p>We inherit our Hierarchical Finite State Machine (HFSM), implemented by us in C on the ESP32, from last year.</p>
<p><strong>Note:</strong> Due to COVID and development delays, our FSM implementation remains unchanged from last year (with
a few minor bug fixes). Hence, most of this documentation is borrowed from the RoboCup 2019 Sydney submission
by our previous team (Deus Vult).</p>
<h2 id="introduction">Introduction</h2>
<p>In the simplest possible terms, a Finite State Machine is a model of computation whereby a system (in this case, the 
robot&rsquo;s software), can be in exactly one of finite states at any given time. FSMs are commonly used to manage AI in 
video games and to manage complex system software (for example, our ESP32 uses an FSM internally in its I2C stack). </p>
<p>Each state is designed to handle a very specific set of criteria. Should a state not meet its very specific criteria, it 
will revert to a previous state or change states to a new state. In this way, each state function has only the minimal 
amount of code required to perform one specific action, leading to an efficient and clean codebase.</p>
<h2 id="implementation">Implementation</h2>
<p>Our FSM implementation is entirely our own custom implementation written in pure C11 on the ESP32. It stores its state 
history to a stack data structure, meaning that it’s possible to revert back through states, just like you can undo and 
redo in certain programs.</p>
<p>Each state is represented as a set of functions: state_enter, state_update and state_exit. Enter and exit are called
respectively when the given state is entered into or exited from. Update is called each time the main task’s loop is
executed for the state the robot is in.</p>
<p>Our FSM implementation can be considered to be “hierarchical”, meaning that we have nested state machines. Our global 
state machine has three states: attack, defence and general. Each sub-state-machine has another series of states, listed below.</p>
<h2 id="benefits">Benefits</h2>
<p>The main benefit of the FSM is the improved debugging as a result of the various states. Since the robot must be in one
state at all times, issues can be rapidly identified and pinpointed from the terminal output. This has greatly improved
our efficiency with regards to solving problems and debugging.</p>
<p>It also allows for greater flexibility when programming the robot. New actions can simply be added by adding a new state
to the finite state machine. Furthermore, various additions such as timers can be added quickly and efficiently.</p>
<p>Another benefit is the code cleanliness. Using the FSM we have found, avoids much of the dreaded &ldquo;spaghetti code&rdquo; a lot
of teams have.</p>
<h2 id="drawbacks">Drawbacks</h2>
<p>The main drawback of an FSM is the possibility of rapid alternating between two states caused by logic errors or noise.
At its worse, this can cause the robot get stuck swapping between two states and not make any progress. However, these
instances are not only rare, but solvable, with tuning. Furthermore, the FSM itself makes catching and rectifying these
errors easier.</p>
<h2 id="states">States</h2>
<h3 id="attacker-states">Attacker states</h3>
<p>Idle: entered into when the robot cannot see the ball for 5 seconds. Manoeuvres into the centre of the field.</p>
<p>Pursue: entered into when the robot needs to move quickly towards the ball when it is far away.</p>
<p>Orbit: our exponential orbit, entered into when the robot is behind the ball and needs to be in front of it.</p>
<p>Dribble: once the robot has the ball in its capture zone, this state is entered into. Accelerates the robot linearly towards the goal.</p>
<h3 id="defender-states">Defender states</h3>
<p>Reverse: entered into when the goal is not visible. Reverses and aligns itself to the back wall with the LRF</p>
<p>Idle: entered into when the ball is not visible. Manoeuvres in front of the goal.</p>
<p>Defend: entered into when the robot is visible. Positions itself between the ball and the goal.</p>
<p>Surge: entered into when the robot is in possession of the ball. Rushes forward to put distance between the ball and the goal. If the other robot is active, it will switch to attacker state.</p>
<h3 id="general-states-shared">General states (shared)</h3>
<p>Shoot: entered into when the robot is has a clear shot of the goal. Activates solenoid kicker.</p>
<h2 id="timers">Timers</h2>
<p>Timers are an essential part of our robots behaviour, and are particularly relevant for our finite state machine. We use FreeRTOS’ highly efficient software timers, which use zero CPU time and add zero overhead to the tick unless they’re activated. We extended FreeRTOS’ timer system using a custom add-on layer that we developed, to assist in creating timers, stopping them and starting them if they’re not already running.</p>
<h3 id="list-of-timers">List of timers</h3>
<p>Bluetooth packet timer: if a BT packet is not received in this time, the other robot must be off for damage</p>
<p>Cooldown timer: after a switch, this timer is started, and another switch is not permitted until it expires</p>
<p>Idle timer: if the ball is not visible for this time, switch into idle state</p>
<p>Dribble timer: if the ball is in the capture zone and close enough for this time, switch into dribble state</p>
<p>Surge timer: same as the above for defender, but switch into surge state</p>
<p>Shoot timer: if the ball is in the capture zone for long enough, kick</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../omicontrol/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Omicontrol
              </div>
            </div>
          </a>
        
        
          <a href="../strategy/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Game strategies
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright (c) 2020 Team Omicron. Documentation is under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>